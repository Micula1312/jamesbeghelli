const JB_VERSION="2025-09-01-06";console.info("[JAMES] app.js version",JB_VERSION);const FIT_MODE="contain",images=["img/image1.jpeg","img/image2.jpeg","img/image4.jpeg","img/image5.jpeg","img/image6.jpeg","img/image7.jpeg","img/image8.jpeg","img/image9.jpeg"],WALLPAPERS=[{src:"img/wallpapers/tile.png",opts:{mode:"tile",repeat:"repeat",position:"top left"}},{src:"img/wallpapers/wallpaper.jpg",opts:{mode:"cover",repeat:"no-repeat",position:"center"}}];let wpIndex=0;const stickers=["img/stickers/sticker.png"],FOLDER_ICON_SRC="img/ui/folder-sfoglia.png",VIEWER_ICON_SRC="img/ui/viewer-phone.png",projects=[{id:"ritratti",title:"Ritratti",slug:"jamesbeghelli/ritratti",icon:FOLDER_ICON_SRC,desc:"Serie di ritratti \u2014 volti, luci, texture.",items:["img/ritratti/001.jpg","img/ritratti/002.jpg","img/ritratti/003.jpg"]},{id:"zonzo",title:"Zonzo",slug:"jamesbeghelli/zonzo",icon:FOLDER_ICON_SRC,desc:"Camminate e scatti in giro, urban roaming.",items:["img/zonzo/001.jpg","img/zonzo/002.jpg","img/zonzo/003.jpg"]},{id:"moda-random",title:"Moda \u2014 Random",slug:"jamesbeghelli/moda-random",icon:FOLDER_ICON_SRC,desc:"Shooting moda sparsi, backstage e prove.",items:["img/moda-random/001.jpg","img/moda-random/002.jpg","img/moda-random/003.jpg"]},{id:"bdbaggies",title:"BDBaggies",slug:"jamesbeghelli/bdbaggies",icon:FOLDER_ICON_SRC,desc:"Capsule / collab BDBaggies.",items:["img/bdbaggies/001.jpg","img/bdbaggies/002.jpg","img/bdbaggies/003.jpg"]},{id:"rapper",title:"Rapper",slug:"jamesbeghelli/rapper",icon:FOLDER_ICON_SRC,desc:"Ritratti, backstage e live set di rapper.",items:["img/rapper/001.jpg","img/rapper/002.jpg","img/rapper/003.jpg"]}],BIO_TEXT=`
Bologna, 20 Marzo 1989

Vive e lavora a Bologna

Andrea Baraldi, in arte James Beghelli, ha iniziato la sua produzione creativa frequentando il corso di Decorazione, la materia in cui ha ottenuto la laurea presso l\u2019Accademia di Belle Arti di Bologna. Fin dall\u2019inizio della sua attivit\xE0 ha tentato di riunire le competenze possedute in differenti ambiti: illustrazione, stampa e fotografia, cos\xEC da sviluppare un profilo artistico poliedrico e capace di operare con strumenti diversi. 

Il suo stile \xE8 funzionale alle discipline che padroneggia ed elementi di ognuna si possono riscoprire in tutte le sue creazioni artistiche. Da sempre ama giocare con gli \u201Cerrori\u201D di realizzazione, perch\xE9 in essi ritrova la vitalit\xE0 e il carattere che contraddistingue l\u2019opera nella sua realizzazione finale. 

Nutre un forte interesse per la fotografia analogica che cerca di fondere con l\u2019utilizzo degli strumenti digitali per creare un legame tra passato e presente.

Contatti

jamesbeghelli33@gmail.com

instagram: @jamesbeghelli
`.trim(),rand=(t,e)=>Math.random()*(e-t)+t,rint=(t,e)=>Math.floor(rand(t,e));function clamp(t,e,a){return Math.max(e,Math.min(a,t))}function fitRect(t,e,a,n,i="contain"){const d=t/e,r=a/n;if(i==="contain"?d>r:d<r){const c=a,p=a/d;return{x:0,y:(n-p)/2,w:c,h:p}}const s=n,l=n*d;return{x:(a-l)/2,y:0,w:l,h:s}}const COMET_SIZE={min:100,max:200},FX_Z=2147483647,DEBUG_COMET=!1;function fxAppend(t){let e=document.getElementById("fx-layer");e||(e=document.createElement("div"),e.id="fx-layer",Object.assign(e.style,{position:"fixed",inset:"0",overflow:"visible",pointerEvents:"none",zIndex:String(FX_Z),isolation:"isolate"}),document.body.appendChild(e)),e!==document.body.lastElementChild&&document.body.appendChild(e),t.style.zIndex=String(FX_Z+1),e.appendChild(t)}const viewport=document.getElementById("viewport"),vpImg=document.getElementById("vpImg"),btnBio=document.getElementById("btn-bio"),bioTpl=document.getElementById("bio-template"),btnSaluta=document.getElementById("btn-saluta"),toolReload=document.getElementById("tool-reload"),toolBack=document.getElementById("tool-back"),toolFwd=document.getElementById("tool-forward"),logBody=document.getElementById("logBody"),browserEl=document.querySelector(".browser"),titlebarEl=document.querySelector(".titlebar"),desktopEl=document.getElementById("desktop"),winTpl=document.getElementById("win-template"),mainBtnClose=document.querySelector('.browser .tb-controls [data-action="close"]'),mainBtnMin=document.querySelector('.browser .tb-controls [data-action="min"]'),mainBtnMax=document.querySelector('.browser .tb-controls [data-action="max"]'),state={index:0,src:null,natW:0,natH:0};function addLine(t){if(!logBody)return;const e=document.createElement("div");e.className="line",e.textContent=t,logBody.appendChild(e),logBody.scrollTop=logBody.scrollHeight}function setInitialBackground(){if(!images.length||!vpImg)return;state.index=0;const t=images[state.index],e=new Image;e.src=t,e.onload=()=>{state.src=t,state.natW=e.naturalWidth,state.natH=e.naturalHeight,vpImg.src=t,addLine("Welcome in a baba random space"),addLine("Navigator 2.0 pronto.")}}const COLS=20,ROWS=12,TILE_DUR=420,ROW_DELAY=18,STEP_COUNT=10;function changeImageTo(t){if(!images.length||!viewport||!vpImg)return;const e={src:state.src,natW:state.natW,natH:state.natH},a=images[(t+images.length)%images.length];if(!e.src){const i=new Image;i.src=a,i.onload=()=>{state.index=(t+images.length)%images.length,state.src=a,state.natW=i.naturalWidth,state.natH=i.naturalHeight,vpImg.src=a};return}const n=new Image;n.src=a,n.onload=()=>{const i=viewport.clientWidth,d=viewport.clientHeight,r=fitRect(e.natW,e.natH,i,d,FIT_MODE);vpImg.src=a,state.index=(t+images.length)%images.length,state.src=a,state.natW=n.naturalWidth,state.natH=n.naturalHeight;const o=document.createElement("div");o.className="crumble",viewport.appendChild(o);const s=Math.ceil(r.w/COLS),l=Math.ceil(r.h/ROWS);for(let p=0;p<ROWS;p++)for(let u=0;u<COLS;u++){const h=u*s,f=p*l,v=r.x+h,x=r.y+f,g=document.createElement("div");g.className="crumb",Object.assign(g.style,{width:s+"px",height:l+"px",left:v+"px",top:x+"px",backgroundImage:`url('${e.src}')`,backgroundSize:`${r.w}px ${r.h}px`,backgroundPosition:`-${h}px -${f}px`}),o.appendChild(g);const m=d+l+60,y=p*ROW_DELAY;g.animate([{transform:"translate(0,0)"},{transform:`translate(0,${m}px)`}],{duration:TILE_DUR,delay:y,easing:`steps(${STEP_COUNT}, end)`,fill:"forwards"})}const c=TILE_DUR+ROW_DELAY*(ROWS-1)+20;setTimeout(()=>{o.remove(),addLine("Operazione completata.")},c),addLine(`Caricamento: ${a.split("/").pop()} ...`)}}function nextImage(){changeImageTo(state.index+1)}function prevImage(){changeImageTo(state.index-1)}toolReload?.addEventListener("click",nextImage),toolBack?.addEventListener("click",prevImage),toolFwd?.addEventListener("click",nextImage);function showToast(t="Ciao!"){const e=document.createElement("div");e.className="toast",e.innerHTML=`<span class="led"></span><span>${t}</span>`,document.body.appendChild(e),setTimeout(()=>{e.style.animation="toast-out .1s steps(3,end) forwards",e.addEventListener("animationend",()=>e.remove(),{once:!0})},1400)}const STICKER_IMGS=[];function preloadStickers(){STICKER_IMGS.length=0,stickers.forEach(t=>{const e=new Image;e.decoding="sync",e.loading="eager",e.src=t+"?v="+JB_VERSION,STICKER_IMGS.push(e)})}btnSaluta?.addEventListener("click",()=>{addLine("Un saluto da James Beghelli."),createCometRandom()});function createCometRandom(){const t=innerWidth,e=innerHeight,a=t/2,n=e/2,i=rint(COMET_SIZE.min,COMET_SIZE.max),d=Math.max(i,140),r=rint(0,4);let o;switch(r){case 0:o={x:-d,y:rint(i/2,Math.max(i/2,e-i/2))};break;case 1:o={x:t+d,y:rint(i/2,Math.max(i/2,e-i/2))};break;case 2:o={x:rint(i/2,Math.max(i/2,t-i/2)),y:-d};break;default:o={x:rint(i/2,Math.max(i/2,t-i/2)),y:e+d};break}let s=a-o.x,l=n-o.y;const c=Math.hypot(s,l)||1;s/=c,l/=c;const p=Math.min(...s>0?[(t-a)/s]:s<0?[(0-a)/s]:[1/0],...l>0?[(e-n)/l]:l<0?[(0-n)/l]:[1/0]),u={x:a+s*(p+d),y:n+l*(p+d)},h=u.x-o.x,f=u.y-o.y,v=Math.hypot(h,f),x=Math.atan2(f,h)*180/Math.PI,g=document.createElement("div");Object.assign(g.style,{position:"fixed",left:o.x+"px",top:o.y+"px",transform:`translate3d(-50%,-50%,0) rotate(${x}deg)`,willChange:"transform",pointerEvents:"none"});const m=document.createElement("img");m.src=STICKER_IMGS.length?STICKER_IMGS[rint(0,STICKER_IMGS.length)].src:stickers[rint(0,stickers.length)],m.decoding="sync",m.loading="eager",m.draggable=!1,m.style.width=i+"px",m.style.height=i+"px";const y=document.createElement("div");Object.assign(y.style,{width:i+"px",height:i+"px",background:"#ff0",border:"2px solid #000"}),g.appendChild(y),fxAppend(g);const L=Math.max(360,Math.min(900,Math.round(v/1)));g.animate([{transform:`translate3d(-50%,-50%,0) rotate(${x}deg) translate(0,0)`},{transform:`translate3d(-50%,-50%,0) rotate(${x}deg) translate(${h}px,${f}px)`}],{duration:L,easing:"linear",fill:"forwards"}).onfinish=()=>g.remove();let w=!1;function b(){w||(w=!0,y.replaceWith(m),m.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:600,iterations:1/0,easing:"linear"}))}if(m.complete&&m.naturalWidth)b();else{const E=setTimeout(()=>b(),160);m.addEventListener("load",()=>{clearTimeout(E),b()},{once:!0}),m.addEventListener("error",()=>{clearTimeout(E)},{once:!0})}}(function(){browserEl&&getComputedStyle(browserEl).position!=="fixed"&&(browserEl.style.position="fixed",browserEl.style.left="0px",browserEl.style.top="0px",console.info("[JAMES] Patched .browser to position:fixed (cache fallback)."))})();function centerBrowser(){if(!browserEl)return;const t=browserEl.getBoundingClientRect(),e=Math.round((window.innerWidth-t.width)/2),a=Math.round((window.innerHeight-t.height)/2);browserEl.style.left=clamp(e,0,Math.max(0,window.innerWidth-t.width))+"px",browserEl.style.top=clamp(a,0,Math.max(0,window.innerHeight-t.height))+"px"}function ensureInBounds(){if(!browserEl)return;const t=browserEl.getBoundingClientRect(),e=Math.max(0,window.innerWidth-t.width),a=Math.max(0,window.innerHeight-t.height);browserEl.style.left=clamp(t.left,0,e)+"px",browserEl.style.top=clamp(t.top,0,a)+"px"}const dragMain={active:!1,pointerId:null,dx:0,dy:0};function isInteractiveTarget(t){return!!t.closest(".tb-controls, .tool-btn, .addr, .addr *")}function onPointerDownMain(t){if(t.button!==0||!titlebarEl||!browserEl||isInteractiveTarget(t.target))return;const e=browserEl.getBoundingClientRect();dragMain.active=!0,dragMain.pointerId=t.pointerId,dragMain.dx=t.clientX-e.left,dragMain.dy=t.clientY-e.top,titlebarEl.classList.add("dragging"),browserEl.classList.add("dragging"),window.addEventListener("pointermove",onPointerMoveMain),window.addEventListener("pointerup",onPointerUpMain,{once:!0}),window.addEventListener("pointercancel",onPointerUpMain,{once:!0})}function onPointerMoveMain(t){if(!dragMain.active||t.pointerId!==dragMain.pointerId||!browserEl)return;const e=browserEl.getBoundingClientRect();let a=t.clientX-dragMain.dx,n=t.clientY-dragMain.dy;a=clamp(a,0,Math.max(0,window.innerWidth-e.width)),n=clamp(n,0,Math.max(0,window.innerHeight-e.height)),browserEl.style.left=a+"px",browserEl.style.top=n+"px"}function onPointerUpMain(t){t&&t.pointerId!==dragMain.pointerId||(dragMain.active=!1,titlebarEl?.classList.remove("dragging"),browserEl?.classList.remove("dragging"),window.removeEventListener("pointermove",onPointerMoveMain))}titlebarEl?.addEventListener("pointerdown",onPointerDownMain),window.addEventListener("resize",ensureInBounds),titlebarEl?.addEventListener("dblclick",centerBrowser),browserEl?.addEventListener("mousedown",()=>bringToFront(browserEl));function openMainViewer(){const t=document.querySelector(".browser");if(!t){showToast("Viewer non disponibile.");return}t.style.display="",ensureInBounds(),bringToFront(t)}mainBtnClose?.addEventListener("click",t=>{t.stopPropagation(),browserEl&&(browserEl.style.display="none",showToast('Viewer nascosto \u2013 usa l\u2019icona "Viewer" per riaprirlo'))}),mainBtnMin?.addEventListener("click",t=>{t.stopPropagation(),browserEl.dataset.minimized=browserEl.dataset.minimized?"":"1",browserEl.style.height=browserEl.dataset.minimized?"44px":"min(78vh,760px)"}),mainBtnMax?.addEventListener("click",t=>{t.stopPropagation(),browserEl.dataset.maximized?(browserEl.dataset.maximized="",browserEl.style.left="0px",browserEl.style.top="0px",browserEl.style.width="min(92vw,1100px)",browserEl.style.height="min(78vh,760px)",centerBrowser()):(browserEl.dataset.maximized="1",browserEl.style.left="0px",browserEl.style.top="0px",browserEl.style.width="100vw",browserEl.style.height="100vh")});let zTop=20;function renderDesktop(){if(!desktopEl)return;desktopEl.innerHTML="";const t=document.createElement("div");t.className="icon",t.tabIndex=0,t.innerHTML=`
    <img class="folder-icon" src="${VIEWER_ICON_SRC}" alt="Viewer">
    <div class="label">Viewer</div>
    `,desktopEl.appendChild(t);const e=t.querySelector(".folder-icon");e.addEventListener("error",()=>{const n=document.createElement("div");n.style.fontSize="36px",n.style.lineHeight="36px",n.textContent="\u{1F4F1}",e.replaceWith(n)}),t.addEventListener("click",()=>{desktopEl.querySelectorAll(".icon.selected").forEach(n=>n.classList.remove("selected")),t.classList.add("selected")}),t.addEventListener("dblclick",openMainViewer),t.addEventListener("keydown",n=>{n.key==="Enter"&&openMainViewer()});let a=0;t.addEventListener("pointerup",n=>{if(n.pointerType!=="touch")return;const i=Date.now();i-a<300?(openMainViewer(),a=0):a=i}),projects.forEach(n=>{const i=document.createElement("div");i.className="icon",i.tabIndex=0,i.dataset.pid=n.id,i.innerHTML=`
      <img class="folder-icon" src="${FOLDER_ICON_SRC}" alt="Cartella">
      <div class="label">${n.title}</div>
    `,desktopEl.appendChild(i);const d=i.querySelector(".folder-icon");d.addEventListener("error",()=>{const o=document.createElement("div");o.style.fontSize="36px",o.style.lineHeight="36px",o.textContent="\u{1F4C1}",d.replaceWith(o)}),i.addEventListener("click",()=>{desktopEl.querySelectorAll(".icon.selected").forEach(o=>o.classList.remove("selected")),i.classList.add("selected")}),i.addEventListener("dblclick",()=>openProjectById(n.id)),i.addEventListener("keydown",o=>{o.key==="Enter"&&openProjectById(n.id)});let r=0;i.addEventListener("pointerup",o=>{if(o.pointerType!=="touch")return;const s=Date.now();s-r<300?(openProjectById(n.id),r=0):r=s})})}function bringToFront(t){document.querySelectorAll(".win.active, .browser.active").forEach(e=>e.classList.remove("active")),t.classList.add("active"),t.style.zIndex=++zTop}function attachDrag(t){const e=t.querySelector(".titlebar");if(!e)return;const a={active:!1,pointerId:null,dx:0,dy:0};function n(r){if(r.button!==0)return;bringToFront(t);const o=t.getBoundingClientRect();a.active=!0,a.pointerId=r.pointerId,a.dx=r.clientX-o.left,a.dy=r.clientY-o.top,e.classList.add("dragging"),t.classList.add("dragging"),window.addEventListener("pointermove",i),window.addEventListener("pointerup",d,{once:!0}),window.addEventListener("pointercancel",d,{once:!0})}function i(r){if(!a.active||r.pointerId!==a.pointerId)return;const o=t.getBoundingClientRect(),s=Math.max(0,window.innerWidth-o.width),l=Math.max(0,window.innerHeight-o.height);let c=r.clientX-a.dx,p=r.clientY-a.dy;c=Math.max(0,Math.min(s,c)),p=Math.max(0,Math.min(l,p)),t.style.left=c+"px",t.style.top=p+"px"}function d(r){r&&r.pointerId!==a.pointerId||(a.active=!1,e.classList.remove("dragging"),t.classList.remove("dragging"),window.removeEventListener("pointermove",i))}e.addEventListener("pointerdown",n)}function attachResize(t,e=360,a=240){if(t.__resizable)return;t.__resizable=!0;const n={e:Object.assign(document.createElement("div"),{className:"rs-e"}),s:Object.assign(document.createElement("div"),{className:"rs-s"}),se:Object.assign(document.createElement("div"),{className:"rs-se"})};Object.assign(n.e.style,{position:"absolute",top:0,right:0,width:"8px",height:"100%",cursor:"e-resize",zIndex:1}),Object.assign(n.s.style,{position:"absolute",left:0,bottom:0,width:"100%",height:"8px",cursor:"s-resize",zIndex:1}),Object.assign(n.se.style,{position:"absolute",right:0,bottom:0,width:"14px",height:"14px",cursor:"se-resize",zIndex:2}),t.appendChild(n.e),t.appendChild(n.s),t.appendChild(n.se);const i={active:!1,pointerId:null,startX:0,startY:0,startW:0,startH:0,dir:""};function d(s){return l=>{if(l.button!==0||t.dataset.maximized)return;bringToFront(t);const c=t.getBoundingClientRect();i.active=!0,i.pointerId=l.pointerId,i.dir=s,i.startX=l.clientX,i.startY=l.clientY,i.startW=c.width,i.startH=c.height,window.addEventListener("pointermove",r),window.addEventListener("pointerup",o,{once:!0}),window.addEventListener("pointercancel",o,{once:!0}),l.preventDefault()}}function r(s){if(!i.active||s.pointerId!==i.pointerId)return;let l=i.startW,c=i.startH;i.dir.includes("e")&&(l=i.startW+(s.clientX-i.startX)),i.dir.includes("s")&&(c=i.startH+(s.clientY-i.startY));const p=t.getBoundingClientRect(),u=window.innerWidth-p.left,h=window.innerHeight-p.top;l=clamp(l,e,Math.max(e,u)),c=clamp(c,a,Math.max(a,h)),t.style.width=l+"px",t.style.height=c+"px"}function o(s){s&&s.pointerId!==i.pointerId||(i.active=!1,window.removeEventListener("pointermove",r))}n.e.addEventListener("pointerdown",d("e")),n.s.addEventListener("pointerdown",d("s")),n.se.addEventListener("pointerdown",d("se"))}function openProjectById(t){const e=projects.find(o=>o.id===t);if(!e||!winTpl)return;const a=document.querySelector(`.win[data-pid="${t}"]`);if(a){bringToFront(a);return}const n=winTpl.content.firstElementChild.cloneNode(!0);n.dataset.pid=e.id,n.style.left=24+Math.random()*60+"px",n.style.top=24+Math.random()*40+"px",n.style.zIndex=++zTop,n.classList.add("active"),getComputedStyle(n).position!=="fixed"&&(n.style.position="fixed"),n.querySelector("[data-title]").textContent=e.title,n.querySelector("[data-slug]").textContent=e.slug;const i=n.querySelector("[data-img]"),d=n.querySelector("[data-desc]");n.__state={idx:0,items:e.items.slice(),project:e};function r(o){const s=n.__state;s.idx=(o+s.items.length)%s.items.length;const l=s.items[s.idx],c=new Image;c.src=l,c.onload=()=>{i.src=l,d.textContent=e.desc||""}}r(0),n.querySelector("[data-prev]").addEventListener("click",()=>r(n.__state.idx-1)),n.querySelector("[data-next]").addEventListener("click",()=>r(n.__state.idx+1)),n.addEventListener("mousedown",()=>bringToFront(n)),n.querySelector('[data-action="close"]').addEventListener("click",()=>n.remove()),n.querySelector('[data-action="min"]').addEventListener("click",()=>{n.dataset.minimized=n.dataset.minimized?"":"1",n.style.height=n.dataset.minimized?"44px":"min(65vh,620px)"}),n.querySelector('[data-action="max"]').addEventListener("click",()=>{n.dataset.maximized?(n.dataset.maximized="",n.style.left="20px",n.style.top="20px",n.style.width="min(70vw,900px)",n.style.height="min(65vh,620px)"):(n.dataset.maximized="1",n.style.left="0px",n.style.top="0px",n.style.width="100vw",n.style.height="100vh")}),attachDrag(n),attachResize(n,320,220),document.body.appendChild(n)}function openBio(){const t=document.querySelector('.win[data-pid="bio"]');if(t){bringToFront(t);return}const e=bioTpl.content.firstElementChild.cloneNode(!0);e.dataset.pid="bio",e.style.left=40+Math.random()*40+"px",e.style.top=40+Math.random()*30+"px",e.style.zIndex=++zTop,e.classList.add("active");const a=e.querySelector("[data-bio]");a.innerHTML=BIO_TEXT.replace(/\n/g,"<br>").replace(/https?:\/\/\S+/g,n=>`<a href="${n}" target="_blank">${n}</a>`),e.style.width="min(60vw,700px)",e.style.height="min(55vh,520px)",e.addEventListener("mousedown",()=>bringToFront(e)),e.querySelector('[data-action="close"]').addEventListener("click",()=>e.remove()),e.querySelector('[data-action="min"]').addEventListener("click",()=>{e.dataset.minimized=e.dataset.minimized?"":"1",e.style.height=e.dataset.minimized?"44px":"min(65vh,620px)"}),e.querySelector('[data-action="max"]').addEventListener("click",()=>{e.dataset.maximized?(e.dataset.maximized="",e.style.left="20px",e.style.top="20px",e.style.width="min(70vw,900px)",e.style.height="min(65vh,620px)"):(e.dataset.maximized="1",e.style.left="0px",e.style.top="0px",e.style.width="100vw",e.style.height="100vh")}),attachDrag(e),attachResize(e,360,260),document.body.appendChild(e)}btnBio?.addEventListener("click",openBio);function setDesktopWallpaper(t,{mode:e="cover",position:a="center",repeat:n="no-repeat"}={}){if(!desktopEl)return;getComputedStyle(desktopEl).position!=="fixed"&&(desktopEl.style.position="fixed"),desktopEl.style.inset="0",desktopEl.style.zIndex="0",desktopEl.style.pointerEvents="auto";const d=new Image;d.src=t,d.onload=()=>{desktopEl.style.backgroundImage=`url("${t}")`,desktopEl.style.backgroundPosition=a,desktopEl.style.backgroundRepeat=n,e==="tile"?(desktopEl.style.backgroundSize="auto",desktopEl.style.imageRendering="pixelated"):e==="contain"?(desktopEl.style.backgroundSize="contain",desktopEl.style.imageRendering=""):e==="stretch"?(desktopEl.style.backgroundSize="100% 100%",desktopEl.style.imageRendering=""):(desktopEl.style.backgroundSize="cover",desktopEl.style.imageRendering="")},d.onerror=()=>{console.warn("[Wallpaper] errore caricamento:",t),desktopEl.style.backgroundImage="",desktopEl.style.backgroundColor="#102030"}}function applyWallpaper(t=0){if(!WALLPAPERS.length)return;const e=WALLPAPERS[t%WALLPAPERS.length];setDesktopWallpaper(e.src,e.opts||{})}function ensureButtonsBarStyles(t){if(!document.getElementById("btnbar-style")){const e=document.createElement("style");e.id="btnbar-style",e.textContent=`
      .btn-bar { display:flex; align-items:center; gap:8px; justify-content:flex-end; flex-wrap:wrap; }
      .btn-bar button { font:700 12px/1 monospace; padding:6px 10px; border:2px outset #ccc; background:#e0e0e0; cursor:pointer; }
      @media (max-width: 560px){
        .btn-bar { justify-content:flex-end; }
        .btn-bar button { margin-top:4px; }
      }
    `,document.head.appendChild(e)}t.classList.add("btn-bar")}function attachWallpaperButtonToBar(){const t=btnSaluta&&btnSaluta.parentElement||document.querySelector(".btn-bar")||document.body;ensureButtonsBarStyles(t);let e=document.getElementById("btn-wallpaper");e?e.parentElement!==t&&t.appendChild(e):(e=document.createElement("button"),e.id="btn-wallpaper",e.textContent="BG",t.appendChild(e),e.addEventListener("click",()=>nextWallpaper()))}function nextWallpaper(){WALLPAPERS.length&&(wpIndex=(wpIndex+1)%WALLPAPERS.length,applyWallpaper(wpIndex))}window.addEventListener("load",()=>{centerBrowser(),setInitialBackground(),renderDesktop(),attachResize(browserEl,500,360),preloadStickers(),applyWallpaper(0),attachWallpaperButtonToBar()}),document.addEventListener("contextmenu",function(e){},{capture:!0});
